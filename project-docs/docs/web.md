# Crawler Web

## 简介
Cralwer Web主要功能是配置网站版块规则和爬虫任务队列管理.

## 网站版块配置

因为爬虫抽取数据规则跟Jquery从html中提取文本很类似, 所以配置爬虫规则之前需对Jquery有所了解.

**配置流程:**

1. 若版块的网站不在*网站配置*中, 则添加一个网站, 添加后点击进去添加版块, 
2. 若已存在版块与将要添加的版块规则一样,则点击*已存在版块*行的添加版块, 否则点击*顶部*添加版块按钮
3. 添加版块后, 接下来才是真正的配置规则. 点击版块进入规则配置.
4. 规则配置分为 `列表页配置`和`详细页配置`, 列表页是指版块页面呈现的成列表状态, 列表中的记录是详细页面的信息
包含链接等; 详细页就是具有详细内容的页面,如论坛版块主贴和回复的信息, 新闻包括新闻内容的信息.配置完规则后可通过点击验证按钮查看规则配置是否正确.

## 任务队列管理
任务队列是由redis构建的,详细构建方式见[crawler master](master.md#_3).
任务队列模块功能包括:
- 添加`网络巡检任务`, `全网搜索任务`
- 显示任务队列
- 查找任务
- 暂停任务
- 删除任务
- 查找已配置的版块

## 规则导入导出
####简介
**规则导入导出**是为了将已配置规则导出到其它配置站点，或导入至某配置站点．
如配置站点Ａ配置了一些版块规则，而配置站点Ｂ没有这些版块规则，现在站点Ｂ需要
抓取这些版块，为防止重新配置带来的麻烦，将站点Ａ的规则导出到站点Ｂ.
那么爬虫Crawler-Web则需要导出导入功能, 提供从网站和版块导入导出接口．
  
####接口设计
* 从网站开始导入导出
**从网站开始导入导出**指将整个网站导入导出到目标站点．

  * 导入接口
  
  接口定义：RuleController

字段  |  值   
-----------|---------
路径     |   config/import   
Method |   POST    
数据格式|  json    


##### 导入数据Json格式

#### 导出接口

接口定义：RuleController.exportWebsite

####如何使用？

### 从网站开始导入导出

**从网站开始导入导出**指将整个网站导入导出到目标站点．

#### 导入接口

字段      |   值
------  ---     |---------
路径      |   config/import
Method  |   POST
数据格式|   json

##### 导入数据Json格式

##### 返回code含义

#### 导出接口

* {返回code含义}

code     |说明             
-----------|---------
   11       |  导入成功    
   21       |  导出成功    


####如何使用？


##开发
### Crawler Web架构
Crawler Web 是基于Spring MVC开发的J2EE架构, 若对Spring MVC不了解, 请阅读<<Spring In Action>>.
DAO层是利用hibernate处理的,hibernate是对象关系映射框架. 
由于在开发初期, 没有考虑到将列表页和详细页归结到一个网站类,如百度类, 所以列表页表`conf_list`和详细页表`conf_detial`没有设计成和表`website`, 
表`section`有关联关系. 这样带来的不利是操作表`website`或表`section`时不能影响表`conf_list`,`conf_detail`,
需要手动操作表`conf_list`,`conf_detail`.
修改办法: 在表`conf_list`和`conf_detail`添加id主键. 不过影响爬虫如何获取到规则,影响较大.

###如何快速开发?
1. Debug某个功能点
2. 看crawler web提供了哪些请求映射
在eclipse sts编辑器中,鼠标放在crawler-web工程中,右击选择spring tools --> request mapping, 即刻查看哪些映射.

## 配置文件
文件名             | 说明                        | 文件在项目中的位置
----------              |------------                   |-------------
db.properties   | 规则mysql数据库配置    |   db.properties
master.properties   | master节点的位置   | master.properties
protocol.properties | 网络配置, 如代理     |
redis.properties        | redis任务队列配置   |
log4j.xml           | 日志配置                  | log4j.xml

##Undo Task List

- [x] 在网站中添加境内外,省份,区域配置
- [x] 修改任务, 添加国内国外区域字段
- [x] 添加server id字段
- [ ] 设计配置导入导出接口
- [ ] 点击右侧已配置版块列表站点可快速添加巡检任务
  
  
